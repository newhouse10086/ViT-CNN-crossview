<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .step-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .data-box { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .operation-box { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .result-box { fill: #e8f5e8; stroke: #388e3c; stroke-width: 2; }
      .text { font-family: "Microsoft YaHei", Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title-text { font-family: "Microsoft YaHei", Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .small-text { font-family: "Microsoft YaHei", Arial, sans-serif; font-size: 10px; text-anchor: middle; }
      .code-text { font-family: "Consolas", "Monaco", monospace; font-size: 10px; text-anchor: middle; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- æ ‡é¢˜ -->
  <text x="700" y="30" class="title-text" font-size="18" fill="#1976d2">Reshape &amp; Permute æ“ä½œè¯¦è§£</text>
  <text x="700" y="50" class="text" fill="#666">ç‰¹å¾å›¾ç»´åº¦å˜æ¢çš„è¯¦ç»†è¿‡ç¨‹</text>
  
  <!-- æ­¥éª¤1: åŸå§‹ç‰¹å¾å›¾ -->
  <rect x="50" y="100" width="300" height="120" rx="10" class="data-box"/>
  <text x="200" y="125" class="title-text">æ­¥éª¤1: åŸå§‹ç‰¹å¾å›¾</text>
  <text x="200" y="145" class="text">ResNet18è¾“å‡º</text>
  <text x="200" y="165" class="small-text">å½¢çŠ¶: (B, 512, 8, 8)</text>
  <text x="200" y="180" class="small-text">B = æ‰¹æ¬¡å¤§å°</text>
  <text x="200" y="195" class="small-text">512 = ç‰¹å¾é€šé“æ•°</text>
  <text x="200" y="210" class="small-text">8Ã—8 = ç©ºé—´ç»´åº¦</text>
  
  <!-- å¯è§†åŒ–åŸå§‹ç‰¹å¾å›¾ -->
  <rect x="80" y="250" width="240" height="120" rx="5" fill="#f8f9fa" stroke="#6c757d" stroke-width="1"/>
  <text x="200" y="270" class="small-text" fill="#333">ç‰¹å¾å›¾å¯è§†åŒ– (ç®€åŒ–)</text>
  
  <!-- ç»˜åˆ¶8x8ç½‘æ ¼ -->
  <g stroke="#999" stroke-width="1" fill="none">
    <line x1="100" y1="280" x2="300" y2="280"/>
    <line x1="100" y1="305" x2="300" y2="305"/>
    <line x1="100" y1="330" x2="300" y2="330"/>
    <line x1="100" y1="355" x2="300" y2="355"/>
    
    <line x1="100" y1="280" x2="100" y2="355"/>
    <line x1="125" y1="280" x2="125" y2="355"/>
    <line x1="150" y1="280" x2="150" y2="355"/>
    <line x1="175" y1="280" x2="175" y2="355"/>
    <line x1="200" y1="280" x2="200" y2="355"/>
    <line x1="225" y1="280" x2="225" y2="355"/>
    <line x1="250" y1="280" x2="250" y2="355"/>
    <line x1="275" y1="280" x2="275" y2="355"/>
    <line x1="300" y1="280" x2="300" y2="355"/>
  </g>
  
  <text x="200" y="295" class="small-text" fill="#666">8Ã—8 = 64ä¸ªç©ºé—´ä½ç½®</text>
  <text x="200" y="320" class="small-text" fill="#666">æ¯ä¸ªä½ç½®æœ‰512ç»´ç‰¹å¾</text>
  <text x="200" y="345" class="small-text" fill="#666">æ€»è®¡: 64 Ã— 512 = 32,768ä¸ªç‰¹å¾å€¼</text>
  
  <!-- æ­¥éª¤2: Reshapeæ“ä½œ -->
  <rect x="400" y="100" width="300" height="120" rx="10" class="operation-box"/>
  <text x="550" y="125" class="title-text">æ­¥éª¤2: Reshapeæ“ä½œ</text>
  <text x="550" y="145" class="text">ç©ºé—´ç»´åº¦å±•å¹³</text>
  <text x="550" y="165" class="code-text">feature_map.view(B, 512, 64)</text>
  <text x="550" y="185" class="small-text">å°†8Ã—8ç©ºé—´ç½‘æ ¼å±•å¹³ä¸º64ä¸ªä½ç½®</text>
  <text x="550" y="200" class="small-text">å½¢çŠ¶å˜åŒ–: (B,512,8,8) â†’ (B,512,64)</text>
  
  <!-- Reshapeå¯è§†åŒ– -->
  <rect x="430" y="250" width="240" height="120" rx="5" fill="#fff8e1" stroke="#f57c00" stroke-width="1"/>
  <text x="550" y="270" class="small-text" fill="#333">Reshapeè¿‡ç¨‹å¯è§†åŒ–</text>
  
  <!-- å±•å¹³è¿‡ç¨‹ -->
  <rect x="450" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  <rect x="475" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  <rect x="500" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  <text x="550" y="292" class="small-text">...</text>
  <rect x="580" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  <rect x="605" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  <rect x="630" y="280" width="20" height="15" fill="#ffcc80" stroke="#f57c00"/>
  
  <text x="550" y="315" class="small-text" fill="#666">64ä¸ªç©ºé—´ä½ç½® (çº¿æ€§æ’åˆ—)</text>
  <text x="550" y="330" class="small-text" fill="#666">æ¯ä¸ªä½ç½®ä»ä¿æŒ512ç»´ç‰¹å¾</text>
  <text x="550" y="345" class="small-text" fill="#666">æ•°æ®å†…å®¹ä¸å˜ï¼Œåªæ”¹å˜å½¢çŠ¶</text>
  
  <!-- æ­¥éª¤3: Permuteæ“ä½œ -->
  <rect x="750" y="100" width="300" height="120" rx="10" class="operation-box"/>
  <text x="900" y="125" class="title-text">æ­¥éª¤3: Permuteæ“ä½œ</text>
  <text x="900" y="145" class="text">ç»´åº¦é¡ºåºäº¤æ¢</text>
  <text x="900" y="165" class="code-text">reshaped.permute(0, 2, 1)</text>
  <text x="900" y="185" class="small-text">äº¤æ¢ç»´åº¦1å’Œç»´åº¦2çš„ä½ç½®</text>
  <text x="900" y="200" class="small-text">å½¢çŠ¶å˜åŒ–: (B,512,64) â†’ (B,64,512)</text>
  
  <!-- Permuteå¯è§†åŒ– -->
  <rect x="780" y="250" width="240" height="120" rx="5" fill="#fff8e1" stroke="#f57c00" stroke-width="1"/>
  <text x="900" y="270" class="small-text" fill="#333">Permuteè¿‡ç¨‹å¯è§†åŒ–</text>
  
  <!-- ç»´åº¦äº¤æ¢ç¤ºæ„ -->
  <text x="820" y="290" class="small-text" fill="#666">äº¤æ¢å‰: (B, 512, 64)</text>
  <text x="820" y="305" class="small-text" fill="#666">ç»´åº¦0: B (æ‰¹æ¬¡)</text>
  <text x="820" y="320" class="small-text" fill="#666">ç»´åº¦1: 512 (ç‰¹å¾)</text>
  <text x="820" y="335" class="small-text" fill="#666">ç»´åº¦2: 64 (ä½ç½®)</text>
  
  <text x="980" y="290" class="small-text" fill="#666">äº¤æ¢å: (B, 64, 512)</text>
  <text x="980" y="305" class="small-text" fill="#666">ç»´åº¦0: B (æ‰¹æ¬¡)</text>
  <text x="980" y="320" class="small-text" fill="#666">ç»´åº¦1: 64 (ä½ç½®)</text>
  <text x="980" y="335" class="small-text" fill="#666">ç»´åº¦2: 512 (ç‰¹å¾)</text>
  
  <!-- æ­¥éª¤4: æœ€ç»ˆç»“æœ -->
  <rect x="1100" y="100" width="250" height="120" rx="10" class="result-box"/>
  <text x="1225" y="125" class="title-text">æ­¥éª¤4: æœ€ç»ˆç»“æœ</text>
  <text x="1225" y="145" class="text">é€‚åˆå¤„ç†çš„æ ¼å¼</text>
  <text x="1225" y="165" class="small-text">å½¢çŠ¶: (B, 64, 512)</text>
  <text x="1225" y="180" class="small-text">64ä¸ªç©ºé—´ä½ç½®</text>
  <text x="1225" y="195" class="small-text">æ¯ä¸ªä½ç½®512ç»´ç‰¹å¾å‘é‡</text>
  <text x="1225" y="210" class="small-text">ä¾¿äºé€ä½ç½®å¤„ç†</text>
  
  <!-- ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åš -->
  <rect x="200" y="420" width="800" height="150" rx="15" fill="#e8f5e8" stroke="#4caf50" stroke-width="2"/>
  <text x="600" y="445" class="title-text" font-size="16" fill="#2e7d32">ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦Reshapeå’ŒPermuteï¼Ÿ</text>
  
  <text x="220" y="470" class="text" fill="#333">1. ğŸ¯ <tspan font-weight="bold">é€‚é…ç¤¾åŒºèšç±»ç®—æ³•</tspan></text>
  <text x="240" y="485" class="small-text" fill="#666">â€¢ ç¤¾åŒºèšç±»éœ€è¦å¤„ç†æ¯ä¸ªç©ºé—´ä½ç½®çš„ç‰¹å¾å‘é‡</text>
  <text x="240" y="500" class="small-text" fill="#666">â€¢ åŸå§‹(B,512,8,8)æ ¼å¼ä¸ä¾¿äºé€ä½ç½®è®¡ç®—ç›¸ä¼¼åº¦</text>
  
  <text x="220" y="520" class="text" fill="#333">2. ğŸ“Š <tspan font-weight="bold">ä¾¿äºç›¸ä¼¼åº¦è®¡ç®—</tspan></text>
  <text x="240" y="535" class="small-text" fill="#666">â€¢ (B,64,512)æ ¼å¼ä¸‹ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªä½ç½®çš„512ç»´ç‰¹å¾</text>
  <text x="240" y="550" class="small-text" fill="#666">â€¢ å¯ä»¥ç›´æ¥è®¡ç®—64Ã—64çš„ç›¸ä¼¼åº¦çŸ©é˜µ</text>
  
  <!-- ä»£ç ç¤ºä¾‹ -->
  <rect x="200" y="600" width="800" height="150" rx="15" fill="#f5f5f5" stroke="#757575" stroke-width="2"/>
  <text x="600" y="625" class="title-text" font-size="16" fill="#424242">ğŸ’» ä»£ç ç¤ºä¾‹</text>
  
  <text x="220" y="650" class="code-text" fill="#333"># åŸå§‹ç‰¹å¾å›¾</text>
  <text x="220" y="665" class="code-text" fill="#333">feature_map = torch.randn(B, 512, 8, 8)  # ResNetè¾“å‡º</text>
  
  <text x="220" y="685" class="code-text" fill="#333"># Reshape: å±•å¹³ç©ºé—´ç»´åº¦</text>
  <text x="220" y="700" class="code-text" fill="#333">reshaped = feature_map.view(B, 512, 64)  # 8*8=64</text>
  
  <text x="220" y="720" class="code-text" fill="#333"># Permute: äº¤æ¢ç»´åº¦é¡ºåº</text>
  <text x="220" y="735" class="code-text" fill="#333">features = reshaped.permute(0, 2, 1)  # (B, 64, 512)</text>
  
  <!-- ç®­å¤´ -->
  <line x1="350" y1="160" x2="400" y2="160" class="arrow"/>
  <line x1="700" y1="160" x2="750" y2="160" class="arrow"/>
  <line x1="1050" y1="160" x2="1100" y2="160" class="arrow"/>
  
  <!-- æ ‡ç­¾ -->
  <text x="375" y="145" class="small-text" fill="#f57c00">Reshape</text>
  <text x="725" y="145" class="small-text" fill="#f57c00">Permute</text>
  <text x="1075" y="145" class="small-text" fill="#4caf50">å®Œæˆ</text>
  
</svg>
